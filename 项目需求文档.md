# 打飞机小游戏 - 项目需求文档

> **创建时间**: 2026年2月9日  
> **平台**: macOS  
> **技术栈**: Python 3 + Pygame  
> **版本**: 1.0

---

## 📋 目录

- [项目概述](#项目概述)
- [技术选型](#技术选型)
- [功能需求](#功能需求)
- [游戏素材](#游戏素材)
- [关卡系统](#关卡系统)
- [敌机配置](#敌机配置)
- [音效系统](#音效系统)
- [项目结构](#项目结构)
- [开发历程](#开发历程)
- [配置参数](#配置参数)

---

## 项目概述

### 项目目标
开发一款可在 macOS 上运行的经典打飞机小游戏（原生应用，非浏览器版本）。

### 核心特性
- ✅ 流畅的飞机控制系统
- ✅ 多样化的敌机类型（8种）
- ✅ 完整的关卡系统（8个关卡）
- ✅ 背景音乐和音效
- ✅ 分数和生命值系统
- ✅ 进度追踪和关卡过渡动画
- ✅ 完整的中文界面支持

---

## 技术选型

### 编程语言
- **Python 3.7+** - 主要开发语言

### 核心库
- **Pygame 2.5.0+** - 游戏引擎
- **Pillow 10.0.0+** - 图像生成
- **NumPy 1.24.0+** - 音频生成

### 字体支持
为解决中文显示问题，使用了以下字体方案：
1. 优先：`/System/Library/Fonts/Hiragino Sans GB.ttc` (苹方黑体)
2. 备选：`/System/Library/Fonts/STHeiti Medium.ttc` (华文黑体)
3. 最终备选：系统默认 Arial

---

## 功能需求

### 基础功能
| 功能 | 描述 | 状态 |
|------|------|------|
| 玩家控制 | 方向键/WASD 控制飞机移动 | ✅ 已实现 |
| 射击系统 | 空格键发射子弹 | ✅ 已实现 |
| 敌机生成 | 自动生成不同类型的敌机 | ✅ 已实现 |
| 碰撞检测 | 子弹与敌机、敌机与玩家的碰撞 | ✅ 已实现 |
| 分数系统 | 击败敌机获得分数 | ✅ 已实现 |
| 生命值系统 | 玩家有3条生命 | ✅ 已实现 |

### 进阶功能
| 功能 | 描述 | 状态 |
|------|------|------|
| 关卡系统 | 8个难度递增的关卡 | ✅ 已实现 |
| 多种敌机 | 8种不同属性的敌机 | ✅ 已实现 |
| 背景音乐 | 循环播放的背景音乐 | ✅ 已实现 |
| 音效系统 | 射击、爆炸、游戏结束音效 | ✅ 已实现 |
| 进度追踪 | 实时显示关卡进度条 | ✅ 已实现 |
| 关卡过渡 | 通关后的过渡动画 | ✅ 已实现 |

---

## 游戏素材

### 图片资源

#### 玩家飞机
- **文件**: `assets/player.png`
- **尺寸**: 60x80 像素
- **颜色**: 蓝色战斗机 (#4A90E2)
- **特点**: 包含机身、机翼、机尾、驾驶舱

#### 敌机类型（plane_models）
| 编号 | 文件名 | 尺寸 | 描述 |
|------|--------|------|------|
| 1 | plane_1.png | 475B | 侦察机 - 红色 |
| 2 | plane_2.png | 553B | 轻型战机 - 红色 |
| 3 | plane_3.png | 583B | 重型战机 - 红色 |
| 4 | plane_4.png | 493B | 喷气战机 - 红色 |
| 5 | plane_5.png | 536B | 轰炸机 - 红色 |
| 6 | plane_6.png | 406B | 隐形战机 - 红色 |
| 7 | plane_7.png | 549B | 精英战机 - 红色 |
| 8 | plane_8.png | 810B | BOSS - 红色 |

#### 子弹
- **玩家子弹**: `assets/bullet.png` (8x20px, 黄色能量弹 #F1C40F)
- **敌机子弹**: `assets/enemy_bullet.png` (6x15px, 红色能量弹 #E74C3C)

#### 特效
- **爆炸效果**: `assets/explosion.png` (64x64px, 多层爆炸效果)
- **背景图片**: `assets/background.png` (800x600px, 太空星空背景 #0A0E27)

### 音频资源

#### 音效文件
| 文件名 | 时长 | 采样率 | 描述 |
|--------|------|--------|------|
| shoot.wav | 0.15s | 22050Hz | 高频激光射击音 (800-200Hz) |
| explosion.wav | 0.4s | 22050Hz | 低频爆炸音 (60-120Hz + 白噪音) |
| game_over.wav | 1.0s | 22050Hz | 游戏结束音 (440Hz衰减) |
| background.wav | 8.0s | 22050Hz | 背景音乐 (简单旋律循环) |

#### 音量设置
- 射击音效: 30%
- 爆炸音效: 50%
- 游戏结束音效: 60%
- 背景音乐: 30%

---

## 关卡系统

### 关卡配置表

| 关卡 | 名称 | 敌机类型 | 生成间隔(帧) | 通关条件 | 特点 |
|------|------|----------|-------------|----------|------|
| 1 | 新手训练 | 侦察机(1) | 80 | 击败3架 | 基础训练 |
| 2 | 空中巡逻 | 侦察机(1) + 轻型战机(2) | 70 | 击败3架 | 混合敌机 |
| 3 | 激烈对抗 | 轻型(2) + 重型战机(3) | 60 | 击败3架 | 生命值提升 |
| 4 | 高速追击 | 轻型(2) + 重型(3) + 喷气(4) | 55 | 击败3架 | 高速敌机 |
| 5 | 轰炸突袭 | 重型(3) + 喷气(4) + 轰炸机(5) | 50 | 击败3架 | 高HP轰炸机 |
| 6 | 隐形威胁 | 喷气(4) + 轰炸(5) + 隐形(6) | 45 | 击败3架 | 超高速 |
| 7 | 精英部队 | 轰炸(5) + 隐形(6) + 精英(7) | 40 | 击败3架 | 密集射击 |
| 8 | 最终决战 | 隐形(6) + 精英(7) + BOSS(8) | 50 | 击败3架 | 终极挑战 |

### 关卡机制
- **进度追踪**: 左侧显示绿色进度条和击杀计数
- **通关判定**: 达到击杀目标后自动进入下一关
- **过渡动画**: 2秒过渡时间，显示关卡完成信息
- **终极胜利**: 完成所有8关显示"恭喜通关！"

---

## 敌机配置

### 敌机属性表

| 类型 | 图片 | 名称 | HP | 速度 | 射击概率 | 分数 | 特点 |
|------|------|------|----|----|---------|------|------|
| 1 | plane_1.png | 侦察机 | 1 | 2.0 | 0.005 | 10 | 基础敌机 |
| 2 | plane_2.png | 轻型战机 | 2 | 2.5 | 0.008 | 15 | 速度提升 |
| 3 | plane_3.png | 重型战机 | 3 | 1.8 | 0.010 | 20 | 高HP |
| 4 | plane_4.png | 喷气战机 | 2 | 3.5 | 0.012 | 25 | 超高速 |
| 5 | plane_5.png | 轰炸机 | 5 | 1.5 | 0.015 | 30 | 超高HP |
| 6 | plane_6.png | 隐形战机 | 3 | 4.0 | 0.010 | 35 | 速度最快 |
| 7 | plane_7.png | 精英战机 | 4 | 3.0 | 0.018 | 40 | 高射击频率 |
| 8 | plane_8.png | BOSS | 10 | 2.0 | 0.025 | 100 | 所有属性最强 |

### 敌机行为
- **移动**: 从屏幕上方随机位置生成，向下移动
- **射击**: 根据射击概率随机发射子弹
- **碰撞**: 与玩家碰撞造成伤害并摧毁
- **击败**: HP归零时播放爆炸特效并给予分数

---

## 音效系统

### 音频生成算法

#### 射击音效 (shoot.wav)
```python
时长: 0.15秒
采样率: 22050Hz
波形: 正弦波
频率: 800Hz → 200Hz (扫频效果)
包络: 指数衰减 (e^(-10t))
音量: 50%
```

#### 爆炸音效 (explosion.wav)
```python
时长: 0.4秒
采样率: 22050Hz
波形: 白噪音 + 低频正弦波
频率: 60Hz + 120Hz
包络: 指数衰减 (e^(-5t))
音量: 60%
```

#### 背景音乐 (background.wav)
```python
时长: 8秒循环
音符: C-D-E-F-G-A-B-C' (Do-Re-Mi-Fa-Sol-La-Si-Do)
旋律模式: [0,2,4,2,0,2,4,2,4,5,7,4,5,7]
音符时长: 8秒 / 14音符
泛音: 基频 + 2倍频
音量: 30%
```

### 音效触发时机
- **背景音乐**: 游戏启动时自动循环播放
- **射击音**: 按下空格键发射子弹时
- **爆炸音**: 敌机被击毁、玩家被撞击时
- **游戏结束音**: 玩家生命值归零时（停止背景音乐）

---

## 项目结构

```
PlaneFight/
├── main.py                     # 游戏主程序 (513行)
├── level_config.py             # 关卡配置文件
├── generate_assets.py          # 素材生成脚本
├── generate_sounds.py          # 音效生成脚本
├── requirements.txt            # Python依赖
├── README.md                   # 项目说明
├── 项目需求文档.md             # 本文档
│
├── assets/                     # 游戏资源目录
│   ├── player.png             # 玩家飞机 (810B)
│   ├── enemy.png              # 默认敌机 (540B)
│   ├── bullet.png             # 玩家子弹 (150B)
│   ├── enemy_bullet.png       # 敌机子弹 (130B)
│   ├── explosion.png          # 爆炸特效 (540B)
│   ├── background.png         # 背景图片 (4.83KB)
│   ├── shoot.wav              # 射击音效 (12.96KB)
│   ├── explosion.wav          # 爆炸音效 (34.50KB)
│   ├── game_over.wav          # 游戏结束音效 (86.18KB)
│   └── background.wav         # 背景音乐 (689.11KB)
│
└── plane_models/               # 敌机模型目录
    ├── plane_1.png            # 侦察机 (475B)
    ├── plane_2.png            # 轻型战机 (553B)
    ├── plane_3.png            # 重型战机 (583B)
    ├── plane_4.png            # 喷气战机 (493B)
    ├── plane_5.png            # 轰炸机 (536B)
    ├── plane_6.png            # 隐形战机 (406B)
    ├── plane_7.png            # 精英战机 (549B)
    ├── plane_8.png            # BOSS (810B)
    └── preview.png            # 预览图 (58KB)
```

---

## 开发历程

### 第一阶段：项目初始化 (20:40-20:50)
1. **需求确认**
   - 确定技术栈: Python + Pygame
   - 确定功能范围: 所有基础功能
   - 确定美术风格: 生成基础游戏素材

2. **项目搭建**
   - 创建项目目录结构
   - 生成游戏素材 (玩家飞机、敌机、子弹、爆炸、背景)
   - 编写主游戏代码 (玩家控制、敌机、射击、碰撞检测)
   - 创建 requirements.txt 和 README.md

### 第二阶段：中文支持修复 (20:53-20:56)
**问题**: 游戏界面中文显示为乱码方框

**原因**: Pygame 默认字体不支持中文字符

**解决方案**:
1. 第一次尝试: 使用 `pygame.font.SysFont('pingfang,arial,...')` - 失败
2. 第二次尝试: 直接指定字体文件路径 - 成功
   - 使用 `/System/Library/Fonts/Hiragino Sans GB.ttc`
   - 添加备选方案 STHeiti Medium.ttc

### 第三阶段：音效系统 (21:00-21:05)
1. **音效生成**
   - 安装 NumPy 库
   - 创建 generate_sounds.py
   - 使用代码生成 WAV 音频文件

2. **音效集成**
   - 初始化 pygame.mixer
   - 加载所有音效文件
   - 在游戏事件中触发音效播放
   - 背景音乐循环播放

### 第四阶段：关卡系统 (21:07-21:10)
1. **发现资源**
   - 发现用户在其他对话中生成的 8 个飞机模型

2. **关卡设计**
   - 创建 level_config.py 配置文件
   - 定义 8 个关卡，每关使用不同敌机类型
   - 配置敌机属性 (HP、速度、射击频率、分数)

3. **功能实现**
   - 改造 Enemy 类支持多种类型
   - 添加关卡管理器 (切换、进度、通关判定)
   - 添加关卡 UI (进度条、关卡信息、过渡动画)
   - 修改通关条件为击败 3 架敌机

---

## 配置参数

### 游戏常量
```python
SCREEN_WIDTH = 800          # 窗口宽度
SCREEN_HEIGHT = 600         # 窗口高度
FPS = 60                    # 帧率

PLAYER_SPEED = 5            # 玩家移动速度
BULLET_SPEED = 7            # 玩家子弹速度
ENEMY_BULLET_SPEED = 4      # 敌机子弹速度
```

### 颜色定义
```python
WHITE = (255, 255, 255)     # 白色 - UI文本
BLACK = (0, 0, 0)           # 黑色 - 遮罩
RED = (255, 0, 0)           # 红色 - 游戏结束
GREEN = (0, 255, 0)         # 绿色 - 通关/进度条
```

### 玩家属性
```python
初始生命值: 3
射击间隔: 200ms
移动速度: 5像素/帧
```

### 关卡配置
```python
总关卡数: 8
通关条件: 每关击败 3 架敌机
关卡过渡时间: 2 秒 (120 帧)
```

---

## 游戏操作

### 控制方式
| 操作 | 按键 | 说明 |
|------|------|------|
| 向上移动 | ⬆️ 或 W | - |
| 向下移动 | ⬇️ 或 S | - |
| 向左移动 | ⬅️ 或 A | - |
| 向右移动 | ➡️ 或 D | - |
| 射击 | 空格 | 200ms冷却时间 |
| 重新开始 | R | 仅游戏结束时 |
| 退出游戏 | ESC | 任何时候 |

### 游戏规则
1. **目标**: 击败每关的目标敌机数，通过所有8个关卡
2. **生命值**: 初始3条生命，被撞击或被子弹击中损失1条
3. **得分**: 不同类型敌机给予不同分数（10-100分）
4. **通关**: 完成所有8关显示"恭喜通关！"
5. **失败**: 生命值归零显示"游戏结束！"

---

## 安装与运行

### 环境要求
- macOS 10.13+
- Python 3.7+
- 至少 100MB 可用内存

### 安装步骤
```bash
# 1. 安装依赖
pip3 install -r requirements.txt

# 2. 生成游戏素材（如未生成）
python3 generate_assets.py
python3 generate_sounds.py

# 3. 运行游戏
python3 main.py
```

---

## 未来扩展计划

### 可能的新功能
- [ ] 道具系统（护盾、加血、超级武器、减速）
- [ ] 成就系统
- [ ] 本地排行榜
- [ ] 更多视觉特效（粒子系统、尾焰）
- [ ] 更复杂的 BOSS 战机制
- [ ] 可自定义难度设置
- [ ] 存档系统
- [ ] 多人对战模式

### 技术改进
- [ ] 使用更高质量的音效资源
- [ ] 添加更多背景音乐
- [ ] 优化性能（对象池）
- [ ] 添加设置菜单（音量、难度）
- [ ] 支持手柄控制

---

## 技术亮点

### 1. 中文字体解决方案
通过直接加载 macOS 系统字体文件，完美支持中文显示，并提供多级备选方案。

### 2. 代码生成音效
使用 NumPy 生成音频波形，无需外部音频资源，自给自足。

### 3. 灵活的关卡配置
使用配置文件分离数据和逻辑，便于调整游戏难度和关卡设计。

### 4. 敌机类型系统
通过配置驱动的敌机类型系统，轻松扩展新的敌机种类。

### 5. 资源整合
有效利用用户在其他对话中生成的飞机模型资源。

---

## 开发者信息

- **开发者**: chenxiao06
- **开发时间**: 2026年2月9日 20:40 - 21:12
- **开发周期**: 约 32 分钟
- **代码行数**: 约 700+ 行
- **文件数量**: 23 个文件

---

## 版本历史

### v1.0 (2026-02-09)
- ✅ 完整的游戏基础功能
- ✅ 8 个关卡系统
- ✅ 8 种敌机类型
- ✅ 完整的音效系统
- ✅ 中文界面支持
- ✅ 关卡进度追踪
- ✅ 通关判定与动画

---

## 致谢

感谢 Pygame 社区提供的优秀游戏引擎！

---

**文档版本**: 1.0  
**最后更新**: 2026年2月9日 21:12  
**文档作者**: AI Assistant (CodeFlicker)
